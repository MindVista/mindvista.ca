---
import BaseLayout from "@layouts/BaseLayout.astro";

const { frontmatter, type } = Astro.props;

const categories = frontmatter.categories
    ? Object.entries(frontmatter.categories).map(([name, tags]) => ({
          name,
          tags: tags as string[],
      }))
    : [];
---

<BaseLayout pageTitle={frontmatter.name} description={frontmatter.description} suffix={true}>
    <article class="mx-auto max-w-5xl px-4 py-8">
        <header class="mb-12">
            <h1
                class="mb-4 mt-8 bg-gradient-to-r from-cAccent to-cPurple bg-clip-text text-5xl font-bold text-transparent"
            >
                {frontmatter.name}
            </h1>
            <div class="mb-4 flex items-center">
                <span
                    class={`px-3 py-1 rounded-full text-sm font-medium transition-colors duration-200 ${
                        frontmatter.status === "active"
                            ? "bg-cBackgroundOffsetAccent text-cAccent ring-1 ring-cAccent/20"
                            : "bg-cRed/10 text-cRed ring-1 ring-cRed/20"
                    }`}
                >
                    {frontmatter.status.charAt(0).toUpperCase() + frontmatter.status.slice(1)}
                </span>
            </div>
            <div class="prose max-w-3xl text-cTextOffset">
                <p>{frontmatter.description}</p>
            </div>
        </header>

        <div class="grid grid-cols-1 gap-6 md:grid-cols-2 [&>*:last-child:nth-child(odd)]:md:col-span-2">
            {
                type === "resource" && frontmatter.availability && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Availability</h2>
                        {Array.isArray(frontmatter.availability) ? (
                            <ul class="space-y-1.5">
                                {frontmatter.availability.map((mode: string) => (
                                    <li class="flex items-center capitalize text-cTextOffset">
                                        <span class="mr-2 h-1 w-1 rounded-full bg-cAccent" />
                                        {mode.replace("_", " ")}
                                    </li>
                                ))}
                            </ul>
                        ) : (
                            <p class="text-cTextOffset">{frontmatter.availability.note}</p>
                        )}
                    </section>
                )
            }

            {
                frontmatter.website && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Website</h2>
                        <a
                            href={frontmatter.website}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-cAccent transition-colors duration-200 hover:text-cPurple"
                        >
                            <span>Visit Website</span>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="ml-1 h-4 w-4"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                                    clip-rule="evenodd"
                                />
                            </svg>
                        </a>
                    </section>
                )
            }

            {
                frontmatter.social_media && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Social Media</h2>
                        <div class="space-y-2">
                            {frontmatter.social_media.facebook && (
                                <a
                                    href={frontmatter.social_media.facebook}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center text-cTextOffset transition-colors duration-200 hover:text-cAccent"
                                >
                                    <span class="w-5">
                                        <svg role="img" viewBox="0 0 24 24" class="h-4 w-4 fill-current">
                                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                                        </svg>
                                    </span>
                                    <span class="ml-2">Facebook</span>
                                </a>
                            )}
                            {frontmatter.social_media.instagram && (
                                <a
                                    href={frontmatter.social_media.instagram}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center text-cTextOffset transition-colors duration-200 hover:text-cAccent"
                                >
                                    <span class="w-5">
                                        <svg role="img" viewBox="0 0 24 24" class="h-4 w-4 fill-current">
                                            <path d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" />
                                        </svg>
                                    </span>
                                    <span class="ml-2">Instagram</span>
                                </a>
                            )}
                            {frontmatter.social_media.other?.map((link: string) => (
                                <a
                                    href={link}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center text-cTextOffset transition-colors duration-200 hover:text-cAccent"
                                >
                                    <span class="w-5">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                    </span>
                                    <span class="ml-2">{new URL(link).hostname}</span>
                                </a>
                            ))}
                        </div>
                    </section>
                )
            }

            {
                frontmatter.contact_info && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Contact Information</h2>
                        <div class="prose text-cTextOffset">
                            <p>{frontmatter.contact_info}</p>
                        </div>
                    </section>
                )
            }

            {
                type === "resource" && frontmatter.location && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Location</h2>
                        <p class="text-cTextOffset">{frontmatter.location}</p>
                    </section>
                )
            }

            {
                type === "resource" && frontmatter.insurance && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Insurance</h2>
                        {frontmatter.insurance.insurance && (
                            <div class="mb-3">
                                <ul class="grid grid-cols-1 gap-1.5 md:grid-cols-3">
                                    {frontmatter.insurance.insurance.map((tag: string) => (
                                        <li class="flex items-center text-cTextOffset">
                                            <span class="mr-2 h-1 w-1 rounded-full bg-cAccent" />
                                            {tag}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                        {frontmatter.insurance.details && (
                            <div class="prose text-cTextOffset">
                                <p>{frontmatter.insurance.details}</p>
                            </div>
                        )}
                    </section>
                )
            }

            {
                categories.length > 0 && (
                    <section class="bg-cBackgroundOffset/50 ring-cBorder/5 h-full rounded-lg p-6 ring-1">
                        <h2 class="mb-3 text-xl font-semibold text-cText">Categories</h2>
                        <div class="space-y-4">
                            {categories.map((category) => (
                                <div class="space-y-2">
                                    <h3 class="text-lg font-medium text-cText">{category.name}</h3>
                                    <div class="flex flex-wrap gap-1.5">
                                        {category.tags.map((tag) => (
                                            <span class="ring-cBorder/20 rounded-full bg-cBackgroundOffsetAccent px-2.5 py-0.5 text-sm text-cTextOffset ring-1">
                                                {tag}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </section>
                )
            }
        </div>
    </article>
</BaseLayout>
